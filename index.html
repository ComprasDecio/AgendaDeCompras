<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calendário de Compras</title>
  <!-- Fonte Roboto -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
    rel="stylesheet"
  />
  <!-- Select2 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
    rel="stylesheet"
  />
  <style>
    /* Estilização geral */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 40px;
      background-color: #f5f7fa;
      color: #333;
      font-size: 1.1rem;
    }
    .header {
      text-align: center;
      margin-bottom: 40px;
      position: relative;
    }
    .header img {
      max-width: 200px;
      margin-bottom: 15px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #0056b3;
      font-weight: 500;
      font-size: 2rem;
    }
    /* Botão toggle */
    .toggle-button {
      position: absolute;
      top: 0;
      right: 0;
      background: linear-gradient(135deg, #0056b3, #003d80);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.9rem;
      box-shadow: 0 2px 8px rgba(0, 86, 179, 0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .toggle-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 86, 179, 0.4);
    }
    .toggle-button.active {
      background: linear-gradient(135deg, #28a745, #20c997);
    }
    .toggle-icon {
      font-size: 1.1rem;
    }
    /* Container principal */
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    /* Filtros */
    .filtros-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .filtro {
      text-align: center;
    }
    .filtro label {
      font-size: 1.1rem;
      margin-right: 10px;
      font-weight: 500;
      display: block;
      margin-bottom: 5px;
    }
    .filtro select {
      padding: 10px 15px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      outline: none;
      transition: border-color 0.3s ease;
      width: 280px;
    }
    .filtro select:focus {
      border-color: #0056b3;
    }
    /* Navegação de meses */
    .navegacao-meses {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 30px;
      gap: 20px;
    }
    .navegacao-meses button {
      background-color: #0056b3;
      color: #fff;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      font-size: 1rem;
    }
    .navegacao-meses button:hover {
      background-color: #003d80;
    }
    .navegacao-meses span {
      font-size: 1.2rem;
      font-weight: 500;
    }
    /* Calendário */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      width: 100%;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    .calendar__day-header {
      background-color: #0056b3;
      color: #fff;
      font-weight: 500;
      padding: 15px 0;
      border-radius: 4px;
      text-align: center;
      font-size: 1rem;
    }
    .calendar__day {
      background-color: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }
    .calendar__day.empty {
      background-color: transparent;
      border: none;
      cursor: default;
    }
    .calendar__day:hover {
      background-color: #f0f8ff;
    }
    .calendar__day.has-agenda {
      background-color: #e8f4ff;
      border-color: #0056b3;
      font-weight: 500;
    }
    .calendar__day.has-entrega {
      background-color: #e8f8e8;
      border-color: #28a745;
      font-weight: 500;
    }
    .calendar__day.selected {
      background-color: #cce5ff;
      border: 2px solid #003d80;
    }
    .calendar__day.selected.has-entrega {
      background-color: #d4edda;
      border: 2px solid #155724;
    }
    /* Modal padrão (detalhes dos dias) */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.4);
    }
    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 700px;
      border-radius: 8px;
      position: relative;
    }
    .close {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
    }
    .modal-content h2 {
      text-align: center;
      margin-bottom: 15px;
      color: #0056b3;
      font-size: 1.5rem;
    }
    .modal-content p {
      margin: 8px 0;
      font-size: 1rem;
    }
    .modal-content hr {
      border: none;
      border-top: 1px solid #eee;
      margin: 15px 0;
    }
    /* Estilizando o pop-up de alerta inicial */
    #popupAlert .modal-content {
      padding: 30px;
      border-radius: 10px;
      background: linear-gradient(135deg, #fdfbfb, #ebedee);
      border: 2px solid #ff4444;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: popUp 0.5s ease-out;
      max-width: 500px;
    }
    @keyframes popUp {
      from {
        transform: scale(0.8);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }
    /* Destaque para a palavra "Atenção" */
    .alert-header {
      background-color: #ff4444;
      color: #ffffff;
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      font-weight: 900;
      margin-bottom: 0.5rem;
      display: inline-block;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    @media (max-width: 768px) {
      body {
        padding: 20px;
      }
      .toggle-button {
        position: relative;
        margin: 0 auto 20px;
        top: auto;
        right: auto;
      }
      .filtros-container {
        flex-direction: column;
        align-items: center;
      }
      .calendar {
        padding: 15px;
        gap: 5px;
      }
      .calendar__day {
        min-height: 60px;
        font-size: 1rem;
      }
      .calendar__day-header {
        padding: 10px 0;
        font-size: 0.9rem;
      }
      .navegacao-meses button {
        padding: 10px 15px;
        font-size: 0.9rem;
      }
      .navegacao-meses span {
        font-size: 1rem;
      }
      .modal-content {
        width: 90%;
        margin: 20% auto;
      }
    }
    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 220px;
      height: 100vh;
      background: linear-gradient(135deg, #003d80 70%, #0056b3 100%);
      padding-top: 40px;
      box-shadow: 2px 0 8px rgba(0,0,0,0.07);
      z-index: 1100;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: width 0.3s cubic-bezier(.4,2,.6,1), background 0.3s;
    }
    .sidebar.minimized {
      width: 60px;
      padding-top: 20px;
    }
    .sidebar-toggle {
      position: absolute;
      top: 10px;
      right: -18px;
      background: #fff;
      border: 1px solid #0056b3;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: right 0.3s;
      z-index: 1200;
    }
    .sidebar.minimized .sidebar-toggle {
      right: -18px;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
      width: 100%;
      margin-top: 40px;
    }
    .sidebar-btn {
      width: 90%;
      background: none;
      border: none;
      color: #fff;
      font-size: 1.1rem;
      padding: 16px 0 16px 12px;
      margin: 10px 0;
      text-align: left;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, font-size 0.2s;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.03);
    }
    .sidebar-btn.active, .sidebar-btn:hover {
      background: #fff;
      color: #0056b3;
      font-weight: 700;
    }
    .sidebar-icon {
      font-size: 1.4rem;
      display: inline-block;
      min-width: 28px;
      text-align: center;
    }
    .sidebar-text {
      transition: opacity 0.2s, width 0.2s;
      white-space: normal;
      overflow: visible;
    }
    .sidebar.minimized .sidebar-text {
      opacity: 0;
      width: 0;
      padding: 0;
    }
    .sidebar.minimized .sidebar-btn {
      justify-content: center;
      padding-left: 0;
      font-size: 1.3rem;
    }
    .sidebar-bottom {
      margin-top: auto;
      padding: 20px 0;
      width: 100%;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    .sidebar-btn-reclamacao {
      width: 100%;
      margin: 0;
      background: linear-gradient(135deg, #ff6b6b, #ee5a52) !important;
      color: #fff !important;
      border: none;
      transition: all 0.3s ease;
    }
    .sidebar-btn-reclamacao:hover {
      background: linear-gradient(135deg, #ff5252, #d32f2f) !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
    }
    .sidebar.minimized .sidebar-bottom {
      padding: 15px 0;
    }
    .main-content {
      margin-left: 220px;
      padding: 0;
      min-height: 100vh;
      background: inherit;
      transition: margin-left 0.3s cubic-bezier(.4,2,.6,1);
    }
    .sidebar.minimized ~ .main-content {
      margin-left: 60px;
    }
    @media (max-width: 900px) {
      .sidebar {
        width: 60px;
        padding-top: 20px;
      }
      .sidebar-btn {
        font-size: 0.9rem;
        padding: 12px 0;
        width: 100%;
      }
      .main-content {
        margin-left: 60px;
      }
      .sidebar-text {
        display: none;
      }
    }
    @media (max-width: 600px) {
      .sidebar {
        position: static;
        width: 100%;
        height: auto;
        flex-direction: row;
        box-shadow: none;
        padding: 0;
      }
      .sidebar ul {
        display: flex;
        flex-direction: row;
        width: 100%;
        justify-content: space-around;
        margin-top: 0;
      }
      .sidebar-btn {
        width: 100%;
        border-radius: 0;
        margin: 0;
        padding: 10px 0;
        justify-content: center;
      }
      .main-content {
        margin-left: 0;
      }
      .sidebar-toggle {
        display: none;
      }
    }
  </style>
</head>
<body>
  <nav class="sidebar" id="sidebar">
    <button class="sidebar-toggle" onclick="toggleSidebar()" title="Minimizar/Expandir Menu">
      <span id="sidebarToggleIcon">⏪</span>
    </button>
    <ul>
      <li><button id="btnAgenda" class="sidebar-btn active" onclick="mostrarAba('agenda')"><span class="sidebar-icon">🗓️</span><span class="sidebar-text">Agenda de Compras</span></button></li>
      <li><button id="btnFornecedores" class="sidebar-btn" onclick="mostrarAba('fornecedores')"><span class="sidebar-icon">📦</span><span class="sidebar-text">Pedidos Fornecedores</span></button></li>
      <li><button id="btnAdmin" class="sidebar-btn" onclick="mostrarAba('admin')"><span class="sidebar-icon">⚙️</span><span class="sidebar-text">Administração</span></button></li>
    </ul>
    <div class="sidebar-bottom">
      <button class="sidebar-btn sidebar-btn-reclamacao" onclick="abrirReclamacao()" title="Abra sua reclamação">
        <span class="sidebar-icon">📢</span>
        <span class="sidebar-text">Abra sua reclamação</span>
      </button>
    </div>
  </nav>
  <main class="main-content" id="mainContent">
    <div id="aba-agenda">
      <div class="header">
        <img
          src="logoDecio.png"
          alt="Logo Decio"
        />
        <button id="toggleButton" class="toggle-button" onclick="toggleModoVisualizacao()">
          <span class="toggle-icon">📅</span>
          <span id="toggleText">Solicitação</span>
        </button>
      </div>
      <div class="container">
        <h1>Calendário de Compras</h1>
        <!-- Filtros -->
        <div class="filtros-container">
          <div class="filtro">
            <label for="unidade">Filtrar por Unidade:</label>
            <select id="unidade" onchange="aplicarFiltros()"></select>
          </div>
          <div class="filtro">
            <label for="categoria">Filtrar por Categoria:</label>
            <select id="categoria" onchange="aplicarFiltros()"></select>
          </div>
        </div>
        <!-- Navegação de Meses -->
        <div class="navegacao-meses">
          <button onclick="mudarMes(-1)">Mês Anterior</button>
          <span id="mesAnoDisplay"></span>
          <button onclick="mudarMes(1)">Próximo Mês</button>
        </div>
        <!-- Calendário dinâmico -->
        <div class="calendar" id="calendar">
          <!-- O calendário será gerado via JavaScript -->
        </div>
      </div>
    </div>

    <!-- Aba de Pedidos para Fornecedores -->
    <div id="aba-fornecedores" style="display: none;">
      <div class="header">
        <img src="logoDecio.png" alt="Logo Decio" />
      </div>
      <div class="container">
        <h1>Pedidos para Fornecedores</h1>
        
        <!-- Seletor de Unidade e Data de Entrega -->
        <div class="filtros-container">
          <div class="filtro">
            <label for="unidadeFornecedor">Selecione a Unidade:</label>
            <select id="unidadeFornecedor" onchange="carregarItens()">
              <option value="">Selecione uma unidade...</option>
            </select>
          </div>
          <div class="filtro">
            <label for="dataEntrega">Data de Entrega:</label>
            <input type="date" id="dataEntrega" style="padding: 10px 15px; font-size: 1rem; border: 1px solid #ccc; border-radius: 4px; outline: none; width: 280px;" min="">
          </div>
        </div>

        <!-- Tabela de Itens -->
        <div id="tabelaItens" style="display: none;">
          <div style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); margin-bottom: 20px;">
            <h3>Itens Disponíveis</h3>
            <table id="tabelaPedidos" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
              <thead>
                <tr style="background: #f8f9fa;">
                  <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">Item</th>
                  <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">Categoria</th>
                  <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center;">Valor Unitário</th>
                  <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center;">Quantidade</th>
                  <th style="padding: 12px; border: 1px solid #dee2e6; text-align: center;">Total</th>
                </tr>
              </thead>
              <tbody id="corpoTabela">
                <!-- Itens serão carregados dinamicamente -->
              </tbody>
            </table>
            
            <!-- Total Geral -->
            <div style="text-align: right; margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 4px;">
              <strong style="font-size: 1.2rem;">Total Geral: R$ <span id="totalGeral">0,00</span></strong>
            </div>

            <!-- Botão Enviar -->
            <div style="text-align: center; margin-top: 20px;">
              <button onclick="gerarPDF()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 1.1rem; font-weight: 500; cursor: pointer; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3); transition: all 0.3s ease;">
                📄 Enviar Pedido (PDF)
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Aba Administrativa -->
    <div id="aba-admin" style="display: none;">
      <div class="header">
        <img src="logoDecio.png" alt="Logo Decio" />
      </div>
      <div class="container">
        <h1>Administração de Preços</h1>
        
        <!-- Status das Tabelas -->
        <div style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); margin-bottom: 20px;">
          <h3>Status das Tabelas de Preços</h3>
          <div style="display: flex; gap: 20px; margin-bottom: 15px;">
            <div style="flex: 1;">
              <strong>Tabela Atual:</strong> <span id="tabelaAtual">-</span>
            </div>
            <div style="flex: 1;">
              <strong>Última Atualização:</strong> <span id="ultimaAtualizacao">-</span>
            </div>
            <div style="flex: 1;">
              <strong>Próxima Atualização:</strong> <span id="proximaAtualizacao">-</span>
            </div>
          </div>
          <button onclick="alternarTabela()" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
            🔄 Alternar Tabela Ativa
          </button>
        </div>

        <!-- Gerenciar Preços -->
        <div style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); margin-bottom: 20px;">
          <h3>Gerenciar Preços</h3>
          <div style="margin-bottom: 15px;">
            <label for="tabelaSelecionada">Selecionar Tabela para Editar:</label>
            <select id="tabelaSelecionada" onchange="carregarTabelaPrecos()" style="margin-left: 10px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
              <option value="tabelaPrecos_MG_Uberlandia">MG Uberlândia</option>
              <option value="tabelaPrecos_MG">Minas Gerais</option>
              <option value="tabelaPrecos_GO">Goiás</option>
              <option value="tabelaPrecos_BA">Bahia</option>
              <option value="tabelaPrecos_SP">São Paulo</option>
            </select>
          </div>
          
          <div id="tabelaPrecosContainer">
            <!-- Tabela de preços será carregada aqui -->
          </div>
          
          <div style="text-align: center; margin-top: 20px;">
            <button onclick="salvarPrecos()" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 1.1rem; font-weight: 500; cursor: pointer; margin-right: 10px;">
              💾 Salvar Alterações
            </button>
            <button onclick="atualizarPeriodo()" style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 1.1rem; font-weight: 500; cursor: pointer;">
              📅 Atualizar Período
            </button>
          </div>
        </div>

        <!-- Gerenciar Unidades por Tabela -->
        <div style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
          <h3>Configurar Unidades por Tabela Regional</h3>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
            <div>
              <h4>MG Uberlândia</h4>
              <div id="unidades_MG_Uberlandia" style="max-height: 150px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; border-radius: 4px; font-size: 12px;">
                <!-- Unidades MG Uberlândia -->
              </div>
            </div>
            <div>
              <h4>Minas Gerais</h4>
              <div id="unidades_MG" style="max-height: 150px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; border-radius: 4px; font-size: 12px;">
                <!-- Unidades MG -->
              </div>
            </div>
            <div>
              <h4>Goiás</h4>
              <div id="unidades_GO" style="max-height: 150px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; border-radius: 4px; font-size: 12px;">
                <!-- Unidades GO -->
              </div>
            </div>
            <div>
              <h4>Bahia</h4>
              <div id="unidades_BA" style="max-height: 150px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; border-radius: 4px; font-size: 12px;">
                <!-- Unidades BA -->
              </div>
            </div>
            <div>
              <h4>São Paulo</h4>
              <div id="unidades_SP" style="max-height: 150px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; border-radius: 4px; font-size: 12px;">
                <!-- Unidades SP -->
              </div>
            </div>
          </div>
          <div style="text-align: center; margin-top: 15px;">
            <button onclick="salvarConfiguracaoUnidades()" style="background: linear-gradient(135deg, #6f42c1, #5a32a3); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
              💾 Salvar Configuração
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para exibir detalhes dos dias -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="fecharModal()">&times;</span>
        <div id="detailsContent"></div>
      </div>
    </div>
  </main>

  <!-- Pop-up de alerta inicial (COMENTADO - PODE SER REATIVADO DEPOIS) 
  <div id="popupAlert" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharPopup()">&times;</span>
      <div id="popupContent">
        <p style="font-weight: bold; font-size: 1.2rem; text-align: center;">
          <span class="alert-header">Atenção feriado prolongado:</span>
        </p>
        <p style="font-size: 1.1rem; text-align: center;">
          Devido ao feriado prolongado neste mês, solicitamos que ajustem suas previsões de demanda considerando a sazonalidade desse período.
        </p>
      </div>
    </div>
  </div> -->

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Select2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- jsPDF para gerar PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    let dados = [];
    let dadosFiltrados = [];
    let unidadesGlobais = [];
    let categoriasGlobais = [];
    let modoEntrega = false; // false = abertura, true = entrega
    
    // Variáveis para a aba de fornecedores
    let itensDisponiveis = [];
    let pedidoAtual = {};
    let configData = null;
    let adminAutenticado = false;

    let dataAtual = new Date();
    let mesAtual = dataAtual.getMonth();
    let anoAtual = dataAtual.getFullYear();

    function formatarData(data) {
      if (!data || data.trim().toUpperCase() === "FRACIONADO DURANTE A SEMANA") {
        return data;
      }
      const partes = data.split('/');
      return `${partes[0].padStart(2, '0')}/${partes[1].padStart(2, '0')}/${partes[2]}`;
    }

    function atualizarTituloMes() {
      const mesAnoDisplay = document.getElementById('mesAnoDisplay');
      const meses = [
        "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
        "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
      ];
      mesAnoDisplay.textContent = `${meses[mesAtual]} ${anoAtual}`;
    }

    function gerarOpcoesFiltros() {
      // Gerar opções de unidade
      const selectUnidade = document.getElementById('unidade');
      selectUnidade.innerHTML = '<option value="">Todas as Unidades</option>';
      const unidadesSet = new Set();
      
      // Gerar opções de categoria
      const selectCategoria = document.getElementById('categoria');
      selectCategoria.innerHTML = '<option value="">Todas as Categorias</option>';
      const categoriasSet = new Set();
      
      dados.forEach(item => {
        if (item.filial) {
          unidadesSet.add(item.filial);
        }
        if (item.categoria) {
          categoriasSet.add(item.categoria);
        }
      });
      
      const unidades = Array.from(unidadesSet).sort();
      const categorias = Array.from(categoriasSet).sort();
      
      unidadesGlobais = unidades;
      categoriasGlobais = categorias;
      
      unidades.forEach(unidade => {
        const option = document.createElement('option');
        option.value = unidade;
        option.textContent = unidade;
        selectUnidade.appendChild(option);
      });
      
      categorias.forEach(categoria => {
        const option = document.createElement('option');
        option.value = categoria;
        option.textContent = categoria;
        selectCategoria.appendChild(option);
      });
      
      // Configurar Select2
      $(selectUnidade).select2({
        placeholder: 'Todas as Unidades',
        allowClear: true,
        width: 'resolve'
      });
      
      $(selectCategoria).select2({
        placeholder: 'Todas as Categorias',
        allowClear: true,
        width: 'resolve'
      });
    }

    function aplicarFiltros() {
      const unidadeSelecionada = document.getElementById('unidade').value;
      const categoriaSelecionada = document.getElementById('categoria').value;
      
      dadosFiltrados = dados.filter(item => {
        const matchUnidade = !unidadeSelecionada || item.filial === unidadeSelecionada;
        const matchCategoria = !categoriaSelecionada || item.categoria === categoriaSelecionada;
        return matchUnidade && matchCategoria;
      });
      
      gerarCalendario();
    }

    function gerarCalendario() {
      const calendarElement = document.getElementById('calendar');
      calendarElement.innerHTML = '';

      const diasSemana = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
      diasSemana.forEach(diaNome => {
        const headerCell = document.createElement('div');
        headerCell.classList.add('calendar__day-header');
        headerCell.textContent = diaNome;
        calendarElement.appendChild(headerCell);
      });

      const diasNoMes = new Date(anoAtual, mesAtual + 1, 0).getDate();
      const primeiroDiaJS = new Date(anoAtual, mesAtual, 1).getDay();
      const offset = primeiroDiaJS === 0 ? 6 : primeiroDiaJS - 1;

      for (let i = 0; i < offset; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.classList.add('calendar__day', 'empty');
        calendarElement.appendChild(emptyCell);
      }

      for (let dia = 1; dia <= diasNoMes; dia++) {
        const diaCell = document.createElement('div');
        diaCell.classList.add('calendar__day');
        diaCell.textContent = dia;
        diaCell.setAttribute('onclick', `exibirDetalhes('${dia}')`);
        calendarElement.appendChild(diaCell);
      }

      // Filtrar dados do mês atual
      const dadosDoMes = dadosFiltrados.filter(item => {
        let [diaStr, mesStr, anoStr] = modoEntrega ? item.previsaoEntrega.split('/') : item.dataAbertura.split('/');
        const mesItem = parseInt(mesStr) - 1;
        const anoItem = parseInt(anoStr);
        return mesItem === mesAtual && anoItem === anoAtual;
      });

      // Marcar dias no calendário
      dadosDoMes.forEach(item => {
        const dataRelevante = modoEntrega ? item.previsaoEntrega : item.dataAbertura;
        const diaItem = parseInt(dataRelevante.split('/')[0]);
        const index = 7 + offset + (diaItem - 1);
        const diaElement = calendarElement.children[index];
        if (diaElement) {
          if (modoEntrega) {
            diaElement.classList.add('has-entrega');
          } else {
            diaElement.classList.add('has-agenda');
          }
        }
      });
    }

    function exibirDetalhes(dia) {
      const calendarElement = document.getElementById('calendar');
      const detailsContentElement = document.getElementById('detailsContent');
      const diasElements = calendarElement.querySelectorAll('.calendar__day');
      diasElements.forEach(element => element.classList.remove('selected'));
      
      const primeiroDiaJS = new Date(anoAtual, mesAtual, 1).getDay();
      const offset = primeiroDiaJS === 0 ? 6 : primeiroDiaJS - 1;
      const index = 7 + offset + (dia - 1);
      const diaElement = calendarElement.children[index];
      if (diaElement) {
        diaElement.classList.add('selected');
      }
      
      const unidadeSelecionada = document.getElementById('unidade').value;
      const categoriaSelecionada = document.getElementById('categoria').value;
      
      const comprasDoDia = dadosFiltrados.filter(item => {
        const dataRelevante = modoEntrega ? item.previsaoEntrega : item.dataAbertura;
        let [diaStr, mesStr, anoStr] = dataRelevante.split('/');
        const diaItem = parseInt(diaStr);
        const mesItem = parseInt(mesStr) - 1;
        const anoItem = parseInt(anoStr);
        
        return diaItem === parseInt(dia) && mesItem === mesAtual && anoItem === anoAtual;
      });

      const detalhesHTML = comprasDoDia
        .map(compra => {
          const previsaoEntregaValue = 
            (compra.categoria === "PROTEÍNAS (BOVINOS, SUÍNOS, AVES, QUEIJOS, EMBUTIDOS, CONGELADOS, PESCADOS)" && compra.filial === "RESTAURANTE PARADA BONITA")
              ? "FRACIONADO DURANTE A SEMANA"
              : formatarData(compra.previsaoEntrega);
          return `
            <div>
              <p><strong>Data de Abertura:</strong> ${formatarData(compra.dataAbertura)}</p>
              <p><strong>Categoria:</strong> ${compra.categoria}</p>
              <p><strong>Filial:</strong> ${compra.filial}</p>
              <p><strong>Previsão de Entrega:</strong> ${previsaoEntregaValue}</p>
              <hr>
            </div>
          `;
        })
        .join("");

      detailsContentElement.innerHTML = detalhesHTML;
      document.getElementById('modal').style.display = 'block';
    }

    function toggleModoVisualizacao() {
      modoEntrega = !modoEntrega;
      const toggleButton = document.getElementById('toggleButton');
      const toggleText = document.getElementById('toggleText');
      const toggleIcon = document.querySelector('.toggle-icon');
      
      if (modoEntrega) {
        toggleButton.classList.add('active');
        toggleText.textContent = 'Entrega';
        toggleIcon.textContent = '📦';
      } else {
        toggleButton.classList.remove('active');
        toggleText.textContent = 'Solicitação';
        toggleIcon.textContent = '📅';
      }
      
      gerarCalendario();
    }

    function fecharModal() {
      document.getElementById('modal').style.display = 'none';
    }

    // Função para fechar o pop-up inicial (COMENTADA - PODE SER REATIVADA DEPOIS)
    /*
    function fecharPopup() {
      document.getElementById("popupAlert").style.display = "none";
    }
    */

    function mudarMes(direcao) {
      mesAtual += direcao;
      if (mesAtual < 0) {
        mesAtual = 11;
        anoAtual -= 1;
      } else if (mesAtual > 11) {
        mesAtual = 0;
        anoAtual += 1;
      }
      atualizarTituloMes();
      gerarCalendario();
    }

    // Alternância de abas
    function mostrarAba(aba) {
      document.getElementById('aba-agenda').style.display = aba === 'agenda' ? 'block' : 'none';
      document.getElementById('aba-fornecedores').style.display = aba === 'fornecedores' ? 'block' : 'none';
      document.getElementById('aba-admin').style.display = aba === 'admin' ? 'block' : 'none';
      
      document.getElementById('btnAgenda').classList.toggle('active', aba === 'agenda');
      document.getElementById('btnFornecedores').classList.toggle('active', aba === 'fornecedores');
      document.getElementById('btnAdmin').classList.toggle('active', aba === 'admin');
      
      // Carregar dados das abas quando necessário
      if (aba === 'fornecedores') {
        carregarUnidadesFornecedores();
      }
      if (aba === 'admin') {
        verificarSenhaAdmin();
      }
    }

    // Minimizar/Expandir Sidebar
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.getElementById('mainContent');
      sidebar.classList.toggle('minimized');
      // Ajusta o ícone do botão
      const icon = document.getElementById('sidebarToggleIcon');
      if (sidebar.classList.contains('minimized')) {
        icon.textContent = '⏩';
      } else {
        icon.textContent = '⏪';
      }
    }

    function abrirReclamacao() {
      window.open('https://www.cervelloesm.com.br/GrupoDecio/Workflow/CatalogoServico/SubMenu?p=pkyM4%2FqIy0E%3D&m=lq8IF7Xgai4%3D&u=pkyM4%2FqIy0E%3D', '_blank');
    }

    // ===== FUNCIONALIDADES DA ABA FORNECEDORES =====

    function carregarUnidadesFornecedores() {
      const selectUnidade = document.getElementById('unidadeFornecedor');
      if (!selectUnidade) {
        console.error('Elemento selectUnidade não encontrado');
        return;
      }
      
      selectUnidade.innerHTML = '<option value="">Selecione uma unidade...</option>';
      
      console.log('Carregando unidades...', configData);
      
      // Lista de unidades padrão para garantir que sempre haja opções
      const unidadesPadrao = [
        "CONVENIENCIA L2",
        "CONVENIENCIA L3", 
        "CONVENIENCIA L4",
        "CONVENIENCIA L5",
        "CONVENIENCIA L6",
        "CONVENIENCIA L7",
        "CONVENIENCIA L13",
        "CONVENIENCIA L14",
        "RESTAURANTE BARREIRAS",
        "RESTAURANTE CENTRALINA",
        "RESTAURANTE ARAPORA",
        "RESTAURANTE CAMPINA VERDE",
        "RESTAURANTE ITUIUTABA",
        "RESTAURANTE GURUPI",
        "CONVENIENCIA CENTRALINA",
        "CONVENIENCIA ARAPORA",
        "CONVENIENCIA CAMPINA VERDE",
        "CONVENIENCIA ITUIUTABA",
        "CONVENIENCIA GURUPI"
      ];
      
      let unidadesParaCarregar = unidadesPadrao;
      
      if (configData && configData.unidadesPorTabela) {
        // Carregar todas as unidades das 5 tabelas regionais
        const todasUnidades = [];
        Object.values(configData.unidadesPorTabela).forEach(regiao => {
          if (Array.isArray(regiao)) {
            todasUnidades.push(...regiao);
          }
        });
        
        if (todasUnidades.length > 0) {
          // Remover duplicatas (caso existam)
          unidadesParaCarregar = [...new Set(todasUnidades)];
          console.log('Unidades encontradas no config:', unidadesParaCarregar);
        } else {
          console.log('Nenhuma unidade encontrada no config, usando padrão');
        }
      } else {
        console.log('ConfigData não encontrado, usando unidades padrão');
      }
      
      // Carregar as unidades no select
      unidadesParaCarregar.forEach(unidade => {
        const option = document.createElement('option');
        option.value = unidade;
        option.textContent = unidade;
        selectUnidade.appendChild(option);
      });
      
      console.log('Total de unidades carregadas:', unidadesParaCarregar.length);
      
      // Configurar Select2
      try {
        $(selectUnidade).select2({
          placeholder: 'Selecione uma unidade...',
          allowClear: true,
          width: 'resolve'
        });
      } catch (error) {
        console.error('Erro ao configurar Select2:', error);
        // Se Select2 falhar, o select normal ainda funcionará
      }
    }

    function carregarItens() {
      const unidadeSelecionada = document.getElementById('unidadeFornecedor').value;
      const dataEntrega = document.getElementById('dataEntrega').value;
      
      if (!unidadeSelecionada || !configData) {
        document.getElementById('tabelaItens').style.display = 'none';
        return;
      }

      if (!dataEntrega) {
        alert('Por favor, selecione uma data de entrega.');
        return;
      }

      // Determinar qual tabela de preços usar baseado na unidade
      let tabelaPrecos;
      let regiaoUsada = '';
      
      for (const [regiao, unidades] of Object.entries(configData.unidadesPorTabela)) {
        if (unidades.includes(unidadeSelecionada)) {
          tabelaPrecos = configData[`tabelaPrecos_${regiao}`];
          regiaoUsada = regiao;
          break;
        }
      }

      if (!tabelaPrecos) {
        alert('Unidade não encontrada nas tabelas de preços.');
        return;
      }

      itensDisponiveis = tabelaPrecos.itens;
      pedidoAtual = {
        unidade: unidadeSelecionada,
        itens: {},
        total: 0,
        regiao: regiaoUsada,
        dataEntrega: dataEntrega
      };

      renderizarTabelaItens();
      document.getElementById('tabelaItens').style.display = 'block';
    }

    function renderizarTabelaItens() {
      const corpoTabela = document.getElementById('corpoTabela');
      corpoTabela.innerHTML = '';

      itensDisponiveis.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td style="padding: 12px; border: 1px solid #dee2e6;">${item.nome}</td>
          <td style="padding: 12px; border: 1px solid #dee2e6;">${item.categoria}</td>
          <td style="padding: 12px; border: 1px solid #dee2e6; text-align: center;">R$ ${item.valor.toFixed(2).replace('.', ',')} / ${item.unidade}</td>
          <td style="padding: 12px; border: 1px solid #dee2e6; text-align: center;">
            <input type="number" 
                   min="0" 
                   step="0.1"
                   value="0" 
                   style="width: 80px; text-align: center; padding: 5px; border: 1px solid #ccc; border-radius: 4px;"
                   onchange="atualizarQuantidade(${item.id}, this.value, ${item.valor})"
                   id="qtd_${item.id}">
            <small style="display: block; color: #666;">${item.unidade}</small>
          </td>
          <td style="padding: 12px; border: 1px solid #dee2e6; text-align: center; font-weight: bold;" id="total_${item.id}">
            R$ 0,00
          </td>
        `;
        corpoTabela.appendChild(row);
      });

      atualizarTotalGeral();
    }

    function atualizarQuantidade(itemId, quantidade, valorUnitario) {
      const qtd = parseFloat(quantidade) || 0;
      const total = qtd * valorUnitario;
      
      // Atualizar o pedido atual
      if (qtd > 0) {
        pedidoAtual.itens[itemId] = {
          quantidade: qtd,
          valorUnitario: valorUnitario,
          total: total
        };
      } else {
        delete pedidoAtual.itens[itemId];
      }

      // Atualizar o total na linha
      document.getElementById(`total_${itemId}`).textContent = 
        `R$ ${total.toFixed(2).replace('.', ',')}`;

      atualizarTotalGeral();
    }

    function atualizarTotalGeral() {
      let totalGeral = 0;
      
      Object.values(pedidoAtual.itens).forEach(item => {
        totalGeral += item.total;
      });

      pedidoAtual.total = totalGeral;
      document.getElementById('totalGeral').textContent = 
        totalGeral.toFixed(2).replace('.', ',');
    }

    function gerarPDF() {
      if (Object.keys(pedidoAtual.itens).length === 0) {
        alert('Por favor, selecione pelo menos um item para gerar o pedido.');
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Cabeçalho
      doc.setFontSize(20);
      doc.text('PEDIDO PARA FORNECEDOR', 20, 30);
      
      doc.setFontSize(12);
      doc.text('Grupo Decio', 20, 45);
      doc.text(`Unidade: ${pedidoAtual.unidade}`, 20, 55);
      doc.text(`Data do Pedido: ${new Date().toLocaleDateString('pt-BR')}`, 20, 65);
      doc.text(`Data de Entrega: ${new Date(pedidoAtual.dataEntrega).toLocaleDateString('pt-BR')}`, 20, 75);
      
      // Linha separadora
      doc.line(20, 75, 190, 75);

      // Tabela de itens
      doc.setFontSize(10);
      let yPosition = 90;
      
      // Cabeçalho da tabela
      doc.text('ITEM', 20, yPosition);
      doc.text('CATEGORIA', 60, yPosition);
      doc.text('QTD', 120, yPosition);
      doc.text('VALOR UNIT.', 140, yPosition);
      doc.text('TOTAL', 170, yPosition);
      
      yPosition += 10;
      doc.line(20, yPosition, 190, yPosition);
      yPosition += 10;

      // Itens do pedido
      Object.entries(pedidoAtual.itens).forEach(([itemId, item]) => {
        const itemData = itensDisponiveis.find(i => i.id == itemId);
        
        doc.text(itemData.nome.substring(0, 25), 20, yPosition);
        doc.text(itemData.categoria.substring(0, 15), 60, yPosition);
        doc.text(item.quantidade.toString(), 125, yPosition);
        doc.text(`R$ ${item.valorUnitario.toFixed(2)}`, 145, yPosition);
        doc.text(`R$ ${item.total.toFixed(2)}`, 175, yPosition);
        
        yPosition += 10;
        
        if (yPosition > 250) {
          doc.addPage();
          yPosition = 20;
        }
      });

      // Total geral
      yPosition += 20;
      doc.setFontSize(12);
      doc.text(`TOTAL GERAL: R$ ${pedidoAtual.total.toFixed(2).replace('.', ',')}`, 140, yPosition);

      // Informações da unidade
      yPosition += 30;
      doc.setFontSize(10);
      doc.text('INFORMAÇÕES DE ENTREGA:', 20, yPosition);
      yPosition += 10;
      
      const infoEntrega = obterInformacoesEntrega(pedidoAtual.unidade);
      if (infoEntrega) {
        doc.text(`Endereço: ${infoEntrega.endereco}`, 20, yPosition);
        yPosition += 10;
        doc.text(`Cidade: ${infoEntrega.cidade}/${infoEntrega.estado} - CEP: ${infoEntrega.cep}`, 20, yPosition);
        yPosition += 10;
        doc.text(`Telefone: ${infoEntrega.telefone}`, 20, yPosition);
        yPosition += 10;
        doc.text(`Contato: ${infoEntrega.contato}`, 20, yPosition);
        yPosition += 10;
        doc.text(`Email: ${infoEntrega.email}`, 20, yPosition);
        yPosition += 15;
        
        // Adicionar horários de entrega
        doc.setFontSize(10);
        doc.text('HORÁRIOS DE ENTREGA:', 20, yPosition);
        yPosition += 10;
        
        const diasSemana = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'];
        const diasKeys = ['segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado', 'domingo'];
        
        diasKeys.forEach((dia, index) => {
          if (infoEntrega.horariosEntrega && infoEntrega.horariosEntrega[dia]) {
            doc.text(`${diasSemana[index]}: ${infoEntrega.horariosEntrega[dia]}`, 20, yPosition);
            yPosition += 8;
          }
        });
      } else {
        doc.text('Informações de entrega não encontradas', 20, yPosition);
      }

      // Salvar o PDF
      const nomeArquivo = `Pedido_${pedidoAtual.unidade.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
      doc.save(nomeArquivo);

      alert('Pedido gerado com sucesso! O arquivo PDF foi baixado.');
    }

    function obterInformacoesEntrega(unidade) {
      if (configData && configData.informacoesEntrega && configData.informacoesEntrega[unidade]) {
        return configData.informacoesEntrega[unidade];
      }
      return null;
    }

    // ===== FUNCIONALIDADES ADMINISTRATIVAS =====

    function verificarSenhaAdmin() {
      if (adminAutenticado) {
        carregarDadosAdministrativos();
        return;
      }

      const senha = prompt('Digite a senha de administração:');
      if (senha === configData.configuracoes.senhaAdmin) {
        adminAutenticado = true;
        carregarDadosAdministrativos();
      } else if (senha !== null) {
        alert('Senha incorreta!');
        mostrarAba('agenda'); // Volta para a aba de agenda
      }
    }

    async function carregarConfiguracao() {
      try {
        const response = await fetch('config.json');
        if (!response.ok) {
          throw new Error(`Erro ao carregar configuração: ${response.statusText}`);
        }
        configData = await response.json();
        window.configData = configData; // Disponibilizar globalmente
        
        console.log('Configuração carregada:', configData);
        
        // Configurar data mínima para entrega (amanhã)
        const amanha = new Date();
        amanha.setDate(amanha.getDate() + 1);
        const dataMinima = amanha.toISOString().split('T')[0];
        const dataEntregaInput = document.getElementById('dataEntrega');
        if (dataEntregaInput) {
          dataEntregaInput.min = dataMinima;
        }
        
        return configData;
      } catch (error) {
        console.error('Erro ao carregar configuração:', error);
        alert('Erro ao carregar configuração. Verifique o console para mais detalhes.');
        return null;
      }
    }

    function carregarDadosAdministrativos() {
      if (!configData) return;

      // Atualizar status das tabelas
      const regioesNomes = {
        'MG_Uberlandia': 'MG Uberlândia',
        'MG': 'Minas Gerais',
        'GO': 'Goiás',
        'BA': 'Bahia',
        'SP': 'São Paulo'
      };
      
      document.getElementById('tabelaAtual').textContent = regioesNomes[configData.configuracoes.tabelaAtual] || configData.configuracoes.tabelaAtual;
      document.getElementById('ultimaAtualizacao').textContent = configData.configuracoes.ultimaAtualizacao;
      document.getElementById('proximaAtualizacao').textContent = configData.configuracoes.proximaAtualizacao;

      // Carregar unidades por tabela
      carregarUnidadesPorTabela();
      
      // Carregar tabela de preços padrão
      carregarTabelaPrecos();
    }

    function carregarUnidadesPorTabela() {
      const regioes = ['MG_Uberlandia', 'MG', 'GO', 'BA', 'SP'];
      
      regioes.forEach(regiao => {
        const container = document.getElementById(`unidades_${regiao}`);
        if (container) {
          container.innerHTML = '';
          
          configData.unidadesPorTabela[regiao].forEach(unidade => {
            const div = document.createElement('div');
            div.style.cssText = 'padding: 3px; margin: 1px; background: #f8f9fa; border-radius: 3px; font-size: 10px;';
            div.textContent = unidade;
            container.appendChild(div);
          });
        }
      });
    }


    function carregarTabelaPrecos() {
      const tabelaSelecionada = document.getElementById('tabelaSelecionada').value;
      const container = document.getElementById('tabelaPrecosContainer');
      
      if (!configData || !configData[tabelaSelecionada]) {
        container.innerHTML = '<p>Erro ao carregar tabela de preços.</p>';
        return;
      }

      const tabela = configData[tabelaSelecionada];
      
      let html = `
        <div style="margin-bottom: 15px;">
          <strong>Período:</strong> ${tabela.dataInicio} até ${tabela.dataFim}
        </div>
        <table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd;">
          <thead>
            <tr style="background: #f8f9fa;">
              <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Item</th>
              <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Categoria</th>
              <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Unidade</th>
              <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Preço Atual</th>
              <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Novo Preço</th>
            </tr>
          </thead>
          <tbody>
      `;

      tabela.itens.forEach(item => {
        html += `
          <tr>
            <td style="padding: 10px; border: 1px solid #ddd;">${item.nome}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">${item.categoria}</td>
            <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${item.unidade}</td>
            <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">R$ ${item.valor.toFixed(2).replace('.', ',')}</td>
            <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
              <input type="number" 
                     step="0.01" 
                     min="0" 
                     value="${item.valor}" 
                     style="width: 100px; padding: 5px; border: 1px solid #ccc; border-radius: 3px;"
                     data-item-id="${item.id}"
                     data-tabela="${tabelaSelecionada}">
            </td>
          </tr>
        `;
      });

      html += `
          </tbody>
        </table>
      `;

      container.innerHTML = html;
    }

    function salvarPrecos() {
      const inputs = document.querySelectorAll('#tabelaPrecosContainer input[type="number"]');
      const alteracoes = [];

      inputs.forEach(input => {
        const itemId = parseInt(input.dataset.itemId);
        const tabela = input.dataset.tabela;
        const novoPreco = parseFloat(input.value);

        if (novoPreco !== configData[tabela].itens.find(item => item.id === itemId).valor) {
          alteracoes.push({
            itemId,
            tabela,
            precoAnterior: configData[tabela].itens.find(item => item.id === itemId).valor,
            novoPreco
          });
        }
      });

      if (alteracoes.length === 0) {
        alert('Nenhuma alteração foi feita nos preços.');
        return;
      }

      // Aplicar alterações
      alteracoes.forEach(alt => {
        const item = configData[alt.tabela].itens.find(item => item.id === alt.itemId);
        if (item) {
          item.valor = alt.novoPreco;
        }
      });

      alert(`${alteracoes.length} preços foram atualizados com sucesso!`);
      
      // Aqui você pode adicionar código para salvar no servidor
      console.log('Alterações nos preços:', alteracoes);
    }

    function alternarTabela() {
      if (!configData) return;

      const regioes = ['MG_Uberlandia', 'MG', 'GO', 'BA', 'SP'];
      const regioesNomes = {
        'MG_Uberlandia': 'MG Uberlândia',
        'MG': 'Minas Gerais',
        'GO': 'Goiás',
        'BA': 'Bahia',
        'SP': 'São Paulo'
      };

      const indiceAtual = regioes.indexOf(configData.configuracoes.tabelaAtual);
      const proximoIndice = (indiceAtual + 1) % regioes.length;
      const novaTabela = regioes[proximoIndice];
      
      configData.configuracoes.tabelaAtual = novaTabela;
      
      document.getElementById('tabelaAtual').textContent = regioesNomes[novaTabela];
      
      alert(`Tabela ativa alterada para ${regioesNomes[novaTabela]}`);
      
      // Aqui você pode adicionar código para salvar no servidor
      console.log('Tabela ativa alterada para:', novaTabela);
    }

    function atualizarPeriodo() {
      if (!configData) return;

      const hoje = new Date();
      const proximaData = new Date(hoje.getTime() + (14 * 24 * 60 * 60 * 1000)); // +14 dias
      
      configData.configuracoes.ultimaAtualizacao = hoje.toISOString().split('T')[0];
      configData.configuracoes.proximaAtualizacao = proximaData.toISOString().split('T')[0];
      
      // Atualizar datas nas tabelas
      const regioes = ['MG_Uberlandia', 'MG', 'GO', 'BA', 'SP'];
      regioes.forEach(regiao => {
        const tabela = `tabelaPrecos_${regiao}`;
        if (configData[tabela]) {
          configData[tabela].dataInicio = hoje.toISOString().split('T')[0];
          configData[tabela].dataFim = proximaData.toISOString().split('T')[0];
        }
      });

      carregarDadosAdministrativos();
      alert('Período atualizado com sucesso! Próxima atualização em 14 dias.');
      
      // Aqui você pode adicionar código para salvar no servidor
      console.log('Período atualizado:', configData.configuracoes);
    }

    function salvarConfiguracaoUnidades() {
      if (!configData) return;

      alert('Configuração de unidades salva com sucesso!');
      
      // Aqui você pode adicionar código para salvar no servidor
      console.log('Configuração de unidades:', configData.unidadesPorTabela);
    }

    window.onload = async function () {
      try {
        // Carregar dados da agenda
        const response = await fetch('agenda.json');
        if (!response.ok) {
          throw new Error(`Erro ao carregar o JSON: ${response.statusText}`);
        }
        dados = await response.json();
        dadosFiltrados = dados; // Inicialmente, todos os dados
        gerarOpcoesFiltros();
        atualizarTituloMes();
        gerarCalendario();
        
        // Carregar configuração de preços e informações
        await carregarConfiguracao();
        
        // Garantir que as unidades sejam carregadas
        setTimeout(() => {
          carregarUnidadesFornecedores();
        }, 1000);
        
        // Linha comentada para evitar o erro (pode ser reativada quando o popup for necessário)
        // document.getElementById("popupAlert").style.display = "block";
      } catch (error) {
        console.error('Erro ao carregar os dados:', error);
        alert('Erro ao carregar os dados. Verifique o console para mais detalhes.');
      }
    };
  </script>
</body>
</html>